<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">
  <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>
  <title>Posters</title>

  <style>

    #addDiv {
      display: none;
      margin-top: 2%;
    }

    #getById {
      display: none;
      margin-top: 2%;
    }

    #getById {
      display: none;
      margin-top: 2%;
    }

    #randomNbr {
      font-size: 60px;
    }
  </style>
</head>

<body>
  <p style="font-size: 30px;">The Post Wall</p>
  
  <button onclick="getRandomNumber()">Get Random Number</button>
  <button onclick="getAll()">Get All</button>
  <button onclick="showGetId()">Get ID</button>
  <button onclick="showAdd()">Add Post</button>

  <div id="addDiv">
    <h3>Add Post</h3>
    <input type="text" id="subject" name="subject" placeholder="Subject"><br><br>
    <input type="text" id="author" name="author" placeholder="Author"><br><br>
    <input type="text" id="text" name="text" placeholder="Text"><br><br>
    <button onclick="addPost()">Add Post</button>
    <button onclick="showAdd()">Close</button>
  </div>

  <div id="getById">
    <input type="text" id="id" name="id" placeholder="ID..."><br><br>
    <button onclick="getId()">Get</button>
    <button onclick="showGetId()">Close</button>
  </div>

  <p id="randomNbr"></p>
  <p id="table"></p>

</body>
<script>

async function getAll() {
  var xhttp = new XMLHttpRequest();
  xhttp.responseType = 'json';
  var url = 'http://localhost:5050/getAll'
  
  
  xhttp.onreadystatechange = function() {
    var posts = xhttp.response;
    createTables(posts);
    }
   
  xhttp.open("GET", url, true);
  xhttp.send();
}

function createTables(posts) {
  document.getElementById("addDiv").style.display = "none";
  var table = new Tabulator("#table", {
    data:posts,           //load row data from array
    layout:"fitColumns",      //fit columns to width of table
    responsiveLayout:"hide",  //hide columns that dont fit on the table
    tooltips:true,            //show tool tips on cells
    addRowPos:"top",          //when adding a new row, add it to the top of the table
    history:true,             //allow undo and redo actions on the table
    pagination:"local",       //paginate the data
    paginationSize:30,         //allow 10 rows per page of data
    movableColumns:true,      //allow column order to be changed
    resizableRows:true,       //allow row order to be changed
    initialSort:[             //set the initial sort order of the data
        {column:"id", dir:"dsc"},
    ],
    columns:[                 //define the table columns
        {title:"ID", field:"id", editor:"input", width:50},
        {title:"Subject", field:"subject", width:150},
        {title:"Author", field:"author", width:200},
        {title:"Text", field:"text"},
    ],
  });
}

function getRandomNumber() {
  var xhttp = new XMLHttpRequest();
  var url = 'http://localhost:5050/?random=number'
  
  
  xhttp.onreadystatechange = function() {
    var number = xhttp.response;
    document.getElementById("randomNbr").innerHTML = number;
  }
  
  xhttp.open("GET", url, true);
  xhttp.send();
}

function showAdd() {
  var x = document.getElementById("addDiv");
  if (x.style.display === "block") {
    x.style.display = "none";
  } else {
    x.style.display = "block";
  }
}

function showGetId() {
  var x = document.getElementById("getById");
  if (x.style.display === "block") {
    x.style.display = "none";
  } else {
    x.style.display = "block";
  }
}

function addPost() {
  var subject = document.getElementById("subject").value;
  var author = document.getElementById("author").value;
  var text = document.getElementById("text").value;
  var json = {"subject": subject, "author" :author, "text": text};
  var bodyString = JSON.stringify(json);
  console.log(bodyString);

  var xhttp = new XMLHttpRequest();
  xhttp.responseType = 'json';
  var url = 'http://localhost:5050/'
  
  
  xhttp.onreadystatechange = function() {
    var postResponse = xhttp.response;
    showAdd();
    getAll();
  }
  
  xhttp.open("POST", url, true);
  xhttp.send(bodyString);

}

function getId() {
  var id = document.getElementById("id").value;
  var url = "http://localhost:5050/?id=" + id;
  console.log(url)
  var xhttp = new XMLHttpRequest();
  //xhttp.responseType = 'json';

  xhttp.onreadystatechange = function(e) {
    var post = xhttp.response;
    createTables([JSON.parse(post)]);

  }

  xhttp.open("GET", url, false);
  xhttp.send();
}

function outputSingle(post) {
  var table = new Tabulator("#table", {
    data:post, //assign data to table
    autoColumns:true, //create columns from data field names
});
}

</script>
</html>